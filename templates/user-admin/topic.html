{% load static %}
{% load fontawesome_5 %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>DPMEs</title>
    <link />
    {% include 'user-admin/include/head.html' %}
    {% fontawesome_5_static %}
  </head>

  <body class="hold-transition sidebar-mini layout-fixed">
    {% include 'user-admin/include/navbar.html'%}
    <div>{% include 'user-admin/include/sidebar.html' %}</div>
   

    <!--Body Start-->
    <div class="content-wrapper">
        <div class="row p-3">
    
            <div class="col-lg-8">
                <form>
                    <div class="col-12 d-flex align-items-center">
                        <input type="text" name="q" class="form-control ps-5 pe-5 m-3 d-block" placeholder="Enter Key Word">
                        <i class="fas fa-search ms-2"></i>
                    </div>
                </form>
            </div>
            
            
            <div class="col flot-right ">
                <button class="btn btn-primary float-end m-2" 
                data-bs-toggle="modal"
                data-bs-target="#AddTopic"
                data-bs-whatever="@mdo"><i class="fas fa-plus"></i> Add Topic</button>
                <button class="btn btn-primary float-end m-2" 
                
                data-bs-whatever="@mdo"><i class="fas fa-file"></i> Import Topic</button>
            </div>
                    
          </div>

           <div class="col-lg-7 mx-auto d-block">
            {% include 'includes/messages.html' %}
           </div>
       
            <div class="table-responsive m-3 border p-3">
                <table class="table table-striped p-3 table-hover gap-5 bg-white">
                    <thead  >
                        <tr>
                            <th>#</th>
                            <th>Name English</th>
                            <th>Name Amharic</th>
                            <th>Created Date</th>
                            <th>Rank</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody class="p-5">
                      {% if topics %}
                        {% for topic in topics %}
                        <tr >
                            <td>{{forloop.counter}}</td>
                            <td class="p-2">{{topic.title_ENG}}</td>
                            <td>{{topic.title_AMH}}</td>
                            <td>{{topic.created|date:"M d, Y" }}</td>
                            <td>{{topic.rank}}</td>
                            <td>
    
                            <button 
                              class="btn btn-outline-info mt-2 btn-sm btn-update"  
                              data-bs-toggle="modal" 
                              data-bs-target="#UpdateTopicModal"
                              data-bs-whatever="@mdo"
                              data-id = {{topic.id}}
                              data-title_ENG = {{topic.title_ENG}}
                              data-title_AMH = {{topic.title_AMH}}
                              data-is_dashboard = {{topic.is_dashboard}}
                              data-icon = {{topic.icon}}
                              data-rank = {{topic.rank}}
                              >
                              <i class="fa fa-edit"></i> 
                            </button>
                            <button 
                              class="btn btn-outline-danger mt-2 btn-sm btn-delete"  
                              data-bs-toggle="modal" 
                              data-bs-target="#deleteTopicModal"
                              data-bs-whatever="@mdo"
                              data-id = {{topic.id}}
                              data-name = {{topic.title_ENG}}
                              >
                              <i class="fa fa-trash"></i> 
                            </button>
                            </td>
                        </tr>
                      {% endfor %}
                      {% else %}
                      <tr>
                        <td class="text-center text-danger" colspan="9">No Data Found</td>
                      </tr>
                      {% endif %}
                    </tbody>
                  </table>

                  <!-- Pagination -->
         <nav aria-label="Page navigation example">
            <ul class="pagination pagination-circle pagination-outline justify-content-center" >
            {% if topics.has_previous %}
              <li class="page-item">
              <a class="page-link" href="?page={{ topics.previous_page_number }}">Previous</a>
              </li>
            {% else %}
              <li class="page-item disabled">
              <a class="page-link" href="#" tabindex="-1" aria-disabled="True">Previous</a>
              </li>
            {% endif %}
        
            {% if topics.number|add:'-4' > 1 %}
              <li class="page-item"><a class="page-link" href="?page={{ topics.number|add:'-5' }}">&hellip;</a></li>
            {% endif %}
        
            {% for i in topics.paginator.page_range %}
              {% if topics.number == i %}
                <li class="page-item active" aria-current="page">
                <span class="page-link">
                {{ i }}
                <span class="sr-only">(current)</span>
                </span>
              </li>
              {% elif i > topics.number|add:'-5' and i < topics.number|add:'5' %}
                 <li class="page-item"><a class="page-link" href="?page={{ i }}">{{ i }}</a></li>
              {% endif %}
            {% endfor %}
        
            {% if topics.paginator.num_pages > topics.number|add:'4' %}
               <li class="page-item"><a class="page-link" href="?page={{ topics.number|add:'5' }}">&hellip;</a></li>
            {% endif %}
        
            {% if topics.has_next %}
              <li class="page-item">
              <a class="page-link" href="?page={{ topics.next_page_number }}">Next</a>
              </li>
            {% else %}
              <li class="page-item disabled">
              <a class="page-link" href="#" tabindex="-1" aria-disabled="True">Next</a>
              </li>
            {% endif %}
            </ul>
          </nav>
            </div>
       
    
    

    
    <!--Add  Modal-->
      <!-- Modal -->
    <div class="modal fade" id="AddTopic" tabindex="-1" aria-labelledby="AddTopicLabel"
      aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="AddTopicLabel">Topic Information</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
            <form  method="post" enctype="multipart/form-data">
              <div id="detailModalBody" class="modal-body">
                    {% csrf_token %}
                    <div class="form-group">
                        <label for="id_title_ENG">Title (English):</label>
                        {{ form.title_ENG }}
                    </div>
                    <div class="form-group">
                        <label for="id_title_AMH">Title (Amharic):</label>
                        {{ form.title_AMH }}
                    </div>
                    <div class="form-group">
                        <label for="id_icon">Icon:</label>
                        {{ form.icon }}
                    </div>
                    <div class="form-group">
                        <label for="id_is_dashboard">Is Dashboard:</label>
                        {{ form.is_dashboard }}
                    </div>
              </div>
              <div class="modal-footer">
                 <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                 <button type="submit" class="btn btn-primary">Save</button>
              </div>
            </form>
        </div>
      </div>
    </div>
    <!--End Modal -->
    
    <!--Delete  Modal-->
      <!-- Modal -->
      <div class="modal fade" id="deleteTopicModal" tabindex="-1" aria-labelledby="deleteTopicModalLabel"
        aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="deleteTopicModalLabel">Delete Topic</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <p class="h4 fw-normal" id="deleteTopic"></p>
            </div> 
              
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              <a href="#" id="deleteTopicAnchor" type="submit" class="btn btn-danger">Delete</a>
            </div>
            
          </div>
        </div>
      </div>
      <!--End Modal -->
    
        <!--Update Modal-->
      <!-- Modal -->
      <div class="modal fade" id="EditTopicModal" tabindex="-1" aria-labelledby="EditTopicModalLabel"
      aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-text" id="EditTopicModalLabel">Edit faq</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
            <form  id="editfaqForm" method="post" enctype="multipart/form-data">
              <div id="detailModalBody" class="modal-body">
                <input type="hidden" value="" id="id_id">
                {{form.as_p}}
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button  id="saveSector" type="submit" class="btn btn-primary">Save changes</button>
                <button style="display: none;" id="btnLoadding" class="btn btn-primary" type="button" disabled>
                  <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                  Loading...
                </button>
              </div>
    
            </form>
        </div>
      </div>
    </div>
  <!--End Modal -->
    
    
    </div>
        
    </div>
    <!--Body End-->

    {% include 'user-admin/include/footer.html'%}

    <!--Chart -->
    <script src="{% static 'assets/plugins/jquery-ui/jquery-ui.min.js' %}"></script>
    <script src="{% static 'assets/plugins/chart.js/Chart.min.js' %}"></script>
    <script src="{% static 'assets/plugins/jquery-knob/jquery.knob.min.js' %}"></script>
    <script src="{% static 'assets/plugins/moment/moment.min.js' %}"></script>
    <script src="{% static 'assets/plugins/daterangepicker/daterangepicker.js' %}"></script>
    <script src="{% static 'assets/plugins/tempusdominus-bootstrap-4/js/tempusdominus-bootstrap-4.min.js' %}"></script>
    <script src="{% static 'assets/plugins/summernote/summernote-bs4.min.js' %}"></script>
    <script src="{% static 'assets/plugins/overlayScrollbars/js/jquery.overlayScrollbars.min.js' %}"></script>

    {% include 'user-admin/include/footer_js.html'%}
  </body>

  <script>
    $(document).ready(function(){
    
        // Start Detail Data
    
        //Event handler that handle button on Click
        
    
         //Event handler that handle on Click to delete
         $(".btn-delete").on('click', function(){
            
              const buttonData = $(this).data()
              $("#deleteTopicAnchor").attr("href", `/user-admin/delete_topic/${buttonData.id}`)
              $("#deleteTopic").html(`Are you sure you want to delete <div> <code> ${buttonData.name}</code>? </div> `)
            })   
            
            





    $('#editTopicForm').on('submit', function(e){
        e.preventDefault()
        let id = $('#id_id').val()
        let title_ENG = $('#id_title_ENG').val()
        let title_AMH = $('#id_title_AMH').val()
        let icon = $('id_icon').val()
        let is_dashboard = $('#id_is_dashboard')
        let rank = $('#id_rank').val()

       
        $.ajax({
          type: 'POST',
          url : '{% url "edit_topic" %}',
          data: {
              'id' : id,
              'title_ENG' : title_ENG,
              'title_AMH' : title_AMH,
              'icon' : icon,
              'is_dashboard' : is_dashboard,
              'rank' : rank,
              csrfmiddlewaretoken: '{{csrf_token}}'
            },
            beforeSend: function() {
              $('#saveSector').hide()
               $("#btnLoadding").show();
             },
             // hides the loader after completion of request, whether successfull or failor.             
             complete: function() {
              //Show save button finished 
               $('#saveSector').show()
               $("#btnLoadding").hide();
             },
          success: function(response){
            if(response.success){

              //show succuss message
              showToast('&#128515 Hello, User', 'Successfully Updated', 'success' )
              $('#EditfaqModal').modal('hide'); //Hide Modal


              let htmlName = $('#faq_name_'+id)
              let buttonHtml = $('#faqButton_'+id) 
              //Update Table Value
              htmlName.text(text)

              //update Button Value
              buttonHtml.data("text", text)



            }else{
               //show succuss message
               showToast('&#128532 Hello User', 'Failed to update faq.', 'error' )
            }
          },
          error: function(){
            //show succuss message
            showToast('&#128532 Hello User', 'Failed to update faq.', 'error' )
          }
        })
      })

    })
    
    </script>
</html>
