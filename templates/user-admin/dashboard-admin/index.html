{% load static %}
<!DOCTYPE html>
<html lang="en">


<!-- [Head] start -->

<head>
    <title>Home | MoPD Dashboard </title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0,minimal-ui" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="description"
        content="Able Pro is trending dashboard template made using Bootstrap 5 design framework. Able Pro is available in Bootstrap, React, CodeIgniter, Angular,  and .net Technologies." />
    <meta name="keywords"
        content="Bootstrap admin template, Dashboard UI Kit, Dashboard Template, Backend Panel, react dashboard, angular dashboard" />
    <meta name="author" content="Phoenixcoded" />
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.14.0/themes/base/jquery-ui.css">
    <script src="https://cdn.jsdelivr.net/gh/habibmhamadi/multi-select-tag/dist/js/multi-select-tag.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/habibmhamadi/multi-select-tag/dist/css/multi-select-tag.css"/>
  

    {% include 'dashboard/include/head.html' %}
</head>
<!-- [Head] end -->
<style>
    .pc-content {
        min-height: 100vh;
    }

    .pc-content img {
        width: 500px;
    }
</style>

<body data-pc-preset="preset-1" data-pc-sidebar-caption="true" data-pc-layout="vertical" data-pc-direction="ltr"
    data-pc-theme_contrast="" data-pc-theme="light">

    <!-- [ Pre-loader ] start -->
    <div class="loader-bg">
        <div class="loader-track">
            <div class="loader-fill"></div>
        </div>
    </div>
    <!-- [ Pre-loader ] End -->


    <!-- [ Sidebar Menu ] start -->
    <nav class="pc-sidebar"  >
        <div class="navbar-wrapper">
            <div class="text-center">
                <h3  class="bg-primary text-light p-3">{{dashboard.title | capfirst}}</h3>
             </div>
            <div class="navbar-content">

                <ul class="pc-navbar">
    
                    <li class="pc-item  pc-caption">
                        <label>Dashboards</label>
                        <svg class="pc-icon">
                            <use xlink:href="#custom-presentation-chart"></use>
                        </svg>
                    </li>


                    <li class="pc-item pc-hasmenu active pc-trigger">
    
                        <a href="#" class="pc-link">
                            <span class="pc-micon">
                                <svg class="pc-icon"><use xlink:href="#custom-status-up"></use></svg>
                            </span>
                            <span class="pc-mtext">Row</span>
    
                            <span class="pc-arrow">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                    viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                    stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right">
                                    <polyline points="9 18 15 12 9 6"></polyline>
                                </svg>
                            </span>
                        </a>
    
                        <ul class="pc-submenu" style="display: block; box-sizing: border-box;">
                            
                            <li class="pc-item active">
                                <a name="row" class="pc-link border" href="#">Full Width</a>
                            </li>


                        </ul>
    
                    </li>
    
    
                


                    <li class="pc-item pc-hasmenu close pc-trigger">

                        <a href="#" class="pc-link">
                            <span class="pc-micon">
                                <svg class="pc-icon">
                                    <use xlink:href="#custom-status-up"></use>
                                </svg>
                            </span>
                            <span class="pc-mtext">Charts</span>

                            <span class="pc-arrow">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round" class="feather feather-chevron-right">
                                    <polyline points="9 18 15 12 9 6"></polyline>
                                </svg>
                            </span>
                        </a>
    
                        <ul class="pc-submenu" style="display: block; box-sizing: border-box;">
                            
                            {% for component in components%}
                            <li  class="pc-item active">
                                <a class="pc-link" href="#">{{component.name}}</a>
                                <div 
                                    name="component"
                                    data-id="{{component.id}}"
                                    data-is-multiple="{{component.is_multiple}}"
                                    data-is-range="{{component.is_range}}" 
                                    class="text-center">
                                    <img src="/media/{{component.image}}" style="width: 150px;" class="img-fluid" alt="">
                                </div>
                            </li>
                            {% endfor %}

                        </ul>


                    </li>



                </ul>


            </div>


        </div>
    </nav>
    <!-- [ Sidebar Menu ] end -->

    


    {% include 'dashboard/include/header.html' %}



    <div class="pc-container">

        <!-- [ Main Content ] start -->
        <div class="pc-content">
            <div id="droppable2" name="drop-element" class=" " style="height:100vh;"></div>
        </div>

            <!-- [ Main Content ] end -->
        </div>
    </div>


    <!--Modal Add Dashboard Row-->
    <div class="modal fade" id="modalAddDashboardRow" tabindex="-1" aria-labelledby="modalAddDashboardRowLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="modalAddDashboardRowLabel">Add Dashboard</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
           <form id="form-configuration" method="post">
                 <div class="modal-body">
                 <input id="form_col_id" type="hidden" value=""  name="col-id"  >
                  {{form.as_p}}
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                  <button type="submit" class="btn btn-primary">Save changes</button>
                </div>
           </form>
          </div>
        </div>
    </div>

    {% include 'dashboard/include/js.html'%}

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.14.0/jquery-ui.min.js" integrity="sha512-MlEyuwT6VkRXExjj8CdBKNgd+e2H+aYZOCUaCrt9KRk6MlZDOs91V1yK22rwm8aCIsb5Ec1euL8f0g58RKT/Pg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script type="text/javascript">
        //handle on change
        

    
        //handle backend row created
        const handleRowCreated = async () => {
        try {
          let id = await new Promise((resolve, reject) => {
            $.ajax({
              type: 'POST',
              url: `{% url "custom-dashboard-topic" dashboard.id %}`,
              data: {
                'rank': 1,
                csrfmiddlewaretoken: '{{csrf_token}}'
              },
              success: function (response) {
                if (response.success) {
                  resolve(response.row);  // Resolve with the row ID
                } else {
                  reject("Error: Failed to get ID");
                }
              },
              error: function () {
                reject("Error: AJAX request failed");
              }
            });
          });
      
          return id;  // Return the ID after successful AJAX call
      
        } catch (error) {
          console.error(error);  // Log the error if something goes wrong
          return null;  // Return null in case of an error
        }
    };


     //handle on modal col submit
     $("#form-configuration").on('submit', (e)=>{
            e.preventDefault();

            let colId = $("#form_col_id").val();  // Get the column ID

            let isMultiple = $(`#${colId}`).data('isMultiple')
            let isRange =$(`#${colId}`).data('isRange');
            let componentId = $(`#${colId}`).data('id');
            let rowId = $(`#${colId}`).data('rowId');

            let indicator = $("#id_indicator").val();
            let year = $("#id_year").val();
            let data_range_start = $("#id_data_range_start").val();
            let data_range_end = $("#id_data_range_end").val();
            let width = $("#id_width").val();
            
            
    

            let colSize = width == '25%' ? 'col-md-3' : (width == '33%' ? 'col-md-4' : (width == '50%' ? 'col-md-6' : (width == '100%' ? 'col-md-12' : '')));
            document.getElementById(`dragged_${componentId}`).className = colSize;


            $.ajax({
              type: 'POST',
              url: `{% url "custom-dashboard-topic" dashboard.id %}`,
              data: {
                'dashboardId' : $(`#${colId}`).data('col-id') ? $(`#${colId}`).data('col-id') : null,
                'isMultiple': isMultiple,
                'isRange' : isRange,
                'componentId' : componentId,
                'indicator' : indicator,
                'year' : year,
                'data_range_start' : data_range_start,
                'data_range_end' : data_range_end,
                'rowId' : rowId,
                'width' : width,
                csrfmiddlewaretoken: '{{csrf_token}}'
              },
              success: function (response) {
                if (response.success) {
                  console.log("Created", response.id)

                  //assign real data to col
                  $(`#${colId}`).data('col-id', response.id) 
                  $(`#${colId}`).data('col-indicator-id', indicator) 
                  $(`#${colId}`).data('col-year-id', year) 
                  $(`#${colId}`).data('col-width', width)
                  
                  

                  console.log($(`#${colId}`).data())
                } else {
                    console.log('err here')
                }
              },
              error: function () {
                console.log('err there')
              }
            });
    
            
    })


    </script>
    <script src="{% static 'dashboard/assets/js/custom/dashboard-admin.js' %}"></script>

</body>




</html>